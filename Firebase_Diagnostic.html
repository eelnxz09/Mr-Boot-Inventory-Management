<!DOCTYPE html>
<html>
<head>
    <title>Firebase Diagnostic</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 50px auto; 
            padding: 20px;
            background: #f5f5f5;
        }
        .test { 
            background: white; 
            padding: 20px; 
            margin: 10px 0; 
            border-radius: 8px;
            border-left: 4px solid #ccc;
        }
        .success { border-left-color: #4CAF50; }
        .error { border-left-color: #f44336; }
        .warning { border-left-color: #ff9800; }
        h1 { color: #333; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîß Firebase Connection Diagnostic</h1>
    <div id="results"></div>
    
    <script type="module">
        const results = document.getElementById('results');
        
        function log(message, type = 'test') {
            const div = document.createElement('div');
            div.className = `test ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }
        
        // Test 1: Check if Firebase SDK loads
        log('<h3>Test 1: Firebase SDK Loading</h3><p>Attempting to load Firebase...</p>', 'test');
        
        try {
            const { initializeApp } = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js");
            log('<h3>‚úÖ Test 1 Passed</h3><p>Firebase SDK loaded successfully</p>', 'success');
            
            // Test 2: Initialize Firebase
            log('<h3>Test 2: Firebase Initialization</h3><p>Attempting to initialize with your config...</p>', 'test');
            
            const firebaseConfig = {
                apiKey: "AIzaSyAFyPxYstLeXFCZkoCJr8NeFRvazMeEju4",
                authDomain: "boot-7e65c.firebaseapp.com",
                projectId: "boot-7e65c",
                storageBucket: "boot-7e65c.firebasestorage.app",
                messagingSenderId: "415900252904",
                appId: "1:415900252904:web:2a139fe13ebce355c8e75d",
                measurementId: "G-3ZXFKPXJPQ"
            };
            
            const app = initializeApp(firebaseConfig);
            log('<h3>‚úÖ Test 2 Passed</h3><p>Firebase initialized successfully</p><pre>' + JSON.stringify(firebaseConfig, null, 2) + '</pre>', 'success');
            
            // Test 3: Auth
            log('<h3>Test 3: Firebase Auth</h3><p>Loading authentication module...</p>', 'test');
            const { getAuth } = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js");
            const auth = getAuth(app);
            log('<h3>‚úÖ Test 3 Passed</h3><p>Auth module loaded. Current user: ' + (auth.currentUser ? auth.currentUser.email : 'Not logged in') + '</p>', 'success');
            
            // Test 4: Firestore
            log('<h3>Test 4: Firestore Database</h3><p>Loading Firestore module...</p>', 'test');
            const { getFirestore, collection, getDocs } = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js");
            const db = getFirestore(app);
            log('<h3>‚úÖ Test 4 Passed</h3><p>Firestore module loaded successfully</p>', 'success');
            
            // Test 5: Database Rules
            log('<h3>Test 5: Database Access</h3><p>Testing read/write permissions...</p>', 'test');
            
            try {
                const testQuery = await getDocs(collection(db, "orders"));
                log(`<h3>‚úÖ Test 5 Passed</h3><p>Database is accessible! Found ${testQuery.size} orders.</p>`, 'success');
            } catch(e) {
                if(e.code === 'permission-denied') {
                    log(`<h3>‚ùå Test 5 Failed</h3><p><strong>Permission Denied!</strong></p><p>Your Firebase Security Rules are blocking access.</p><p><strong>Solution:</strong> Go to Firebase Console ‚Üí Firestore Database ‚Üí Rules and temporarily set to:</p><pre>rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true;
    }
  }
}</pre><p style="color: red;"><strong>‚ö†Ô∏è Important:</strong> This allows anyone to access your data. Use only for testing, then add proper authentication.</p>`, 'error');
                } else {
                    log(`<h3>‚ö†Ô∏è Test 5 Warning</h3><p>Error: ${e.code}</p><p>${e.message}</p>`, 'warning');
                }
            }
            
            // Summary
            log('<h3>üìä Summary</h3><p>All core modules loaded successfully. If you see a permission error above, update your Firestore rules.</p>', 'success');
            
        } catch(error) {
            log(`<h3>‚ùå Critical Error</h3><p>${error.message}</p><pre>${error.stack}</pre>`, 'error');
        }
    </script>
</body>
</html>
